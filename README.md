# XRD_analysis

## Description

This repository was made as a complement for the [amorph](https://bitbucket.org/eggplantbren/amorph) repository (A program build for analysing X-Ray Diffraction in amorphous materials). It takes the `posterior_sample.txt` that [amorph](https://bitbucket.org/eggplantbren/amorph) generates, and build an HDF5 file for easier access to the data.

The python environment is managed with `uv` and the code also includes a `graphs.py` file to generate graphs with the HDF5 output. **The usability and features are still being worked on**.

## How to use the program

Run the following commands to clone the repository and also build the environment with `uv`.

```
git clone https://github.com/tobiasborgesguimaraes/XRD_analysis.git
cd XRD_analysis
uv sync
```

After analysing your XRD file (stored as `{file_name}.txt`) with [amorph](https://bitbucket.org/eggplantbren/amorph). Copy the `posterior_sample.txt` file to the `RESULTS` directory and named it `{file_name}_results.txt`. After doing that you can run 
```
uv run .\hdf5_analysis.py {file_name}
``` 
to create the HDF5 output. It also works with a list of file names.
```
uv run .\hdf5_analysis.py {file_name1} {file_name2} ...
``` 
Then, by running the code in `graphs.py`, you'll get a view of the amorph's ouput. As well as the graphs being saved in the `GRAPHS` directory.

```
uv run graphs.py {file_name1} {file_name2} ...
```

## HDF5 Structure

Inside the HDF5 file produced. You'll find 4 main `pandas DataFrames`. Called `Points`, `BG_Parameters`, `NA_Parameters` and `WI_Parameters`. Which stand for "Background Parameters", "Narrow Parameters" and "Wide Parameters".

The number of lines in `NA_Parameters` and `WI_Parameters` will depend on how many peaks did [amorph](https://bitbucket.org/eggplantbren/amorph) generate. You can edit their maximum number in `config.yaml`.

### Points DataFrame

The `Points` DataFrame stores all the points generated by the [amorph](https://bitbucket.org/eggplantbren/amorph) program. The code also stores a column for `q` (scattering vector) values.

| 2theta | intensity |     q    |       bg |    wide  | narrow | model_curve |
|-------:|----------:|---------:|---------:|---------:|-------:|------------:|
|   5.54 |       140 | 0.394346 | 157.9820 | 0.040584 |    0.0 |    158.0220 |
|   5.56 |       164 | 0.395768 | 157.6660 | 0.040905 |    0.0 |    157.7070 |
|   5.58 |       142 | 0.397191 | 157.3510 | 0.041228 |    0.0 |    157.3920 |
|   5.60 |       150 | 0.398613 | 157.0350 | 0.041554 |    0.0 |    157.0760 |
|   5.62 |       156 | 0.400036 | 156.7190 | 0.041882 |    0.0 |    156.7610 |

### Background parameters DataFrame

[amorph](https://bitbucket.org/eggplantbren/amorph) fits the background in the XRD as 3 lines connected by control points. These control points can be edited in the `config.yaml` file. You should change it to mach the X-Rays source of the difractometer. The height of each point has the form $be^{n_i}$. Where $b$ is stored in the table as `background`. Which is structured as follows

|background|  n1  |   n2   |    n3   |    n4   |
|---------:|-----:|-------:|--------:|--------:|
|   50.6308|1.2738|-1.16406|-0.694292|-0.425283|

### Narrow parameters DataFrame

The crystalline component is treated by [amorph](https://bitbucket.org/eggplantbren/amorph) as narrow peaks with a shape based on **Student's t-distribution**. The parameters of each narrow peak can be found in the `NA_Parameters` DataFrame. Which is structured as follows

|centers| widths |  areas |
|------:|-------:|-------:|
|28.2578|0.200347|38.77788|
| 30.165|0.133468|21.97796|
|29.5764|0.350967|80.22539|

### Wide parameters DataFrame

The amorphous component is treated by [amorph](https://bitbucket.org/eggplantbren/amorph) as wide peaks with a **Gaussian** shape. The parameters of each gaussian can be found in the `WI_Parameters` DataFrame. Which is structured as follows.

|centers| widths|  areas  |
|------:|------:|--------:|
|11.9295|4.60863|207.85901|
|30.1852|4.64684|251.49673|
|48.2314|5.01987| 71.93263|






